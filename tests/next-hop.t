Test our next-hop routing logic.

  $ CLOG=DEBUG croissant test <<EOF
  > new node 01000000000000000000000000000000;
  > new node 04000000000000000000000000000000;
  > new node 08000000000000000000000000000000;
  > node 01000000000000000000000000000000 {
  >     add leaf set entry 04000000000000000000000000000000;
  >     add leaf set entry 08000000000000000000000000000000;
  >     print next hop for 04000000000000000000000000000000;
  >     print next hop for 04000000000000000000000000000001;
  >     print next hop for 05ffffffffffffffffffffffffffffff;
  >     print next hop for 06000000000000000000000000000000;
  >     print next hop for 06000000000000000000000000000001;
  >     print next hop for 0a0000000000000000000000000a0000;
  >     send hello to      04000000000000000000000000000000;
  >     send world to      06000000000000000000000000000000;
  >     send goodbye to    02000000000000000000000000000000;
  > };
  > EOF
  --- new node 01000000000000000000000000000000
  [local:1] New node 01000000000000000000000000000000
  [local:1] New routing table
  [local:1] New leaf set
  --- new node 04000000000000000000000000000000
  [local:2] New node 04000000000000000000000000000000
  [local:2] New routing table
  [local:2] New leaf set
  --- new node 08000000000000000000000000000000
  [local:3] New node 08000000000000000000000000000000
  [local:3] New routing table
  [local:3] New leaf set
  --- [01000000000000000000000000000000]
  --- add leaf set entry 04000000000000000000000000000000
  [local:1] (leafset) [+ 1] Add 04000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- add leaf set entry 08000000000000000000000000000000
  [local:1] (leafset) [+ 2] Add 08000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- print next hop for 04000000000000000000000000000000
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set)
  Next hop from 01000000000000000000000000000000
             to 04000000000000000000000000000000
             is 04000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- print next hop for 04000000000000000000000000000001
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set)
  Next hop from 01000000000000000000000000000000
             to 04000000000000000000000000000001
             is 04000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- print next hop for 05ffffffffffffffffffffffffffffff
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set)
  Next hop from 01000000000000000000000000000000
             to 05ffffffffffffffffffffffffffffff
             is 04000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- print next hop for 06000000000000000000000000000000
  [local:1] Next hop is 08000000000000000000000000000000 (leaf set)
  Next hop from 01000000000000000000000000000000
             to 06000000000000000000000000000000
             is 08000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- print next hop for 06000000000000000000000000000001
  [local:1] Next hop is 08000000000000000000000000000000 (leaf set)
  Next hop from 01000000000000000000000000000000
             to 06000000000000000000000000000001
             is 08000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- print next hop for 0a0000000000000000000000000a0000
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set fallback)
  Next hop from 01000000000000000000000000000000
             to 0a0000000000000000000000000a0000
             is 04000000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- send "hello" to 04000000000000000000000000000000
  [local:1] Send message to 04000000000000000000000000000000
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set)
  [local:1] {print} Spy on message from 01000000000000000000000000000000 to 04000000000000000000000000000000
  [local:1] Forward via local:2
  [local:1] {local} Send message to local:2
  [local:2] Next hop is self (leaf set)
  [local:2] Deliver message to application "crs_print_message"
  [local:2] Received 04000000000000000000000000000000 hello
  --- [01000000000000000000000000000000]
  --- send "world" to 06000000000000000000000000000000
  [local:1] Send message to 06000000000000000000000000000000
  [local:1] Next hop is 08000000000000000000000000000000 (leaf set)
  [local:1] {print} Spy on message from 01000000000000000000000000000000 to 06000000000000000000000000000000
  [local:1] Forward via local:3
  [local:1] {local} Send message to local:3
  [local:3] Next hop is self (last resort)
  [local:3] Deliver message to application "crs_print_message"
  [local:3] Received 06000000000000000000000000000000 world
  --- [01000000000000000000000000000000]
  --- send "goodbye" to 02000000000000000000000000000000
  [local:1] Send message to 02000000000000000000000000000000
  [local:1] Next hop is self (leaf set)
  [local:1] Deliver message to application "crs_print_message"
  [local:1] Received 02000000000000000000000000000000 goodbye
  ---
  [local:3] Free node
  [local:2] Free node
  [local:1] Free node

  $ CLOG=DEBUG croissant test <<EOF
  > new node 0123456789abcdef0123456789abcdef;
  > new node 00000000000000000000000000000000;
  > new node 01000000000000000000000000000000;
  > node 0123456789abcdef0123456789abcdef {
  >     add routing table entry 00000000000000000000000000000000;
  >     add routing table entry 01000000000000000000000000000000;
  >     print next hop for      00000000000000000000000000000000;
  >     print next hop for      00000000000000000000000000000001;
  >     print next hop for      01000000000000000000000000000000;
  >     print next hop for      01000000000000000000000000000001;
  >     print next hop for      02000000000000000000000000000000;
  >     print next hop for      01100000000000000000000000000000;
  >     print next hop for      01200000000000000000000000000000;
  >     print next hop for      10000000000000000000000000000000;
  >     print next hop for      f0000000000000000000000000000000;
  >     send hello to           01000000000000000000000000000000;
  >     send world to           02000000000000000000000000000000;
  >     send goodbye to         f0000000000000000000000000000000;
  > };
  > EOF
  --- new node 0123456789abcdef0123456789abcdef
  [local:1] New node 0123456789abcdef0123456789abcdef
  [local:1] New routing table
  [local:1] New leaf set
  --- new node 00000000000000000000000000000000
  [local:2] New node 00000000000000000000000000000000
  [local:2] New routing table
  [local:2] New leaf set
  --- new node 01000000000000000000000000000000
  [local:3] New node 01000000000000000000000000000000
  [local:3] New routing table
  [local:3] New leaf set
  --- [0123456789abcdef0123456789abcdef]
  --- add routing table entry 00000000000000000000000000000000
  [local:1] (rtable) [ 1/0] 00000000000000000000000000000000 (new entry)
  --- [0123456789abcdef0123456789abcdef]
  --- add routing table entry 01000000000000000000000000000000
  [local:1] (rtable) [ 2/0] 01000000000000000000000000000000 (new entry)
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 00000000000000000000000000000000
  [local:1] Next hop is 00000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 00000000000000000000000000000000
             is 00000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 00000000000000000000000000000001
  [local:1] Next hop is 00000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 00000000000000000000000000000001
             is 00000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01000000000000000000000000000000
  [local:1] Next hop is 01000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01000000000000000000000000000000
             is 01000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01000000000000000000000000000001
  [local:1] Next hop is 01000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01000000000000000000000000000001
             is 01000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 02000000000000000000000000000000
  [local:1] Next hop is self (last resort)
  Next hop from 0123456789abcdef0123456789abcdef
             to 02000000000000000000000000000000
             is local delivery
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01100000000000000000000000000000
  [local:1] Next hop is 01000000000000000000000000000000 (routing table fallback)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01100000000000000000000000000000
             is 01000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01200000000000000000000000000000
  [local:1] Next hop is self (last resort)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01200000000000000000000000000000
             is local delivery
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 10000000000000000000000000000000
  [local:1] Next hop is self (last resort)
  Next hop from 0123456789abcdef0123456789abcdef
             to 10000000000000000000000000000000
             is local delivery
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for f0000000000000000000000000000000
  [local:1] Next hop is 00000000000000000000000000000000 (routing table fallback)
  Next hop from 0123456789abcdef0123456789abcdef
             to f0000000000000000000000000000000
             is 00000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- send "hello" to 01000000000000000000000000000000
  [local:1] Send message to 01000000000000000000000000000000
  [local:1] Next hop is 01000000000000000000000000000000 (routing table)
  [local:1] {print} Spy on message from 0123456789abcdef0123456789abcdef to 01000000000000000000000000000000
  [local:1] Forward via local:3
  [local:1] {local} Send message to local:3
  [local:3] Next hop is self (leaf set)
  [local:3] Deliver message to application "crs_print_message"
  [local:3] Received 01000000000000000000000000000000 hello
  --- [0123456789abcdef0123456789abcdef]
  --- send "world" to 02000000000000000000000000000000
  [local:1] Send message to 02000000000000000000000000000000
  [local:1] Next hop is self (last resort)
  [local:1] Deliver message to application "crs_print_message"
  [local:1] Received 02000000000000000000000000000000 world
  --- [0123456789abcdef0123456789abcdef]
  --- send "goodbye" to f0000000000000000000000000000000
  [local:1] Send message to f0000000000000000000000000000000
  [local:1] Next hop is 00000000000000000000000000000000 (routing table fallback)
  [local:1] {print} Spy on message from 0123456789abcdef0123456789abcdef to f0000000000000000000000000000000
  [local:1] Forward via local:2
  [local:1] {local} Send message to local:2
  [local:2] Next hop is self (last resort)
  [local:2] Deliver message to application "crs_print_message"
  [local:2] Received f0000000000000000000000000000000 goodbye
  ---
  [local:3] Free node
  [local:2] Free node
  [local:1] Free node

  $ CLOG=DEBUG croissant test <<EOF
  > new node 0123456789abcdef0123456789abcdef;
  > new node 00000000000000000000000000000000;
  > new node 01000000000000000000000000000000;
  > new node 04000000000000000000000000000000;
  > new node 08000000000000000000000000000000;
  > node 0123456789abcdef0123456789abcdef {
  >     add leaf set entry      04000000000000000000000000000000;
  >     add leaf set entry      08000000000000000000000000000000;
  >     add routing table entry 00000000000000000000000000000000;
  >     add routing table entry 01000000000000000000000000000000;
  >     print next hop for      00000000000000000000000000000000;
  >     print next hop for      00000000000000000000000000000001;
  >     print next hop for      01000000000000000000000000000000;
  >     print next hop for      01000000000000000000000000000001;
  >     print next hop for      02000000000000000000000000000000;
  >     print next hop for      01100000000000000000000000000000;
  >     print next hop for      01200000000000000000000000000000;
  >     print next hop for      10000000000000000000000000000000;
  >     print next hop for      f0000000000000000000000000000000;
  >     print next hop for      04000000000000000000000000000000;
  >     print next hop for      04000000000000000000000000000001;
  >     print next hop for      05ffffffffffffffffffffffffffffff;
  >     print next hop for      06000000000000000000000000000000;
  >     print next hop for      06000000000000000000000000000001;
  >     print next hop for      0a0000000000000000000000000a0000;
  > };
  > EOF
  --- new node 0123456789abcdef0123456789abcdef
  [local:1] New node 0123456789abcdef0123456789abcdef
  [local:1] New routing table
  [local:1] New leaf set
  --- new node 00000000000000000000000000000000
  [local:2] New node 00000000000000000000000000000000
  [local:2] New routing table
  [local:2] New leaf set
  --- new node 01000000000000000000000000000000
  [local:3] New node 01000000000000000000000000000000
  [local:3] New routing table
  [local:3] New leaf set
  --- new node 04000000000000000000000000000000
  [local:4] New node 04000000000000000000000000000000
  [local:4] New routing table
  [local:4] New leaf set
  --- new node 08000000000000000000000000000000
  [local:5] New node 08000000000000000000000000000000
  [local:5] New routing table
  [local:5] New leaf set
  --- [0123456789abcdef0123456789abcdef]
  --- add leaf set entry 04000000000000000000000000000000
  [local:1] (leafset) [+ 1] Add 04000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- add leaf set entry 08000000000000000000000000000000
  [local:1] (leafset) [+ 2] Add 08000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- add routing table entry 00000000000000000000000000000000
  [local:1] (rtable) [ 1/0] 00000000000000000000000000000000 (new entry)
  --- [0123456789abcdef0123456789abcdef]
  --- add routing table entry 01000000000000000000000000000000
  [local:1] (rtable) [ 2/0] 01000000000000000000000000000000 (new entry)
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 00000000000000000000000000000000
  [local:1] Next hop is 00000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 00000000000000000000000000000000
             is 00000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 00000000000000000000000000000001
  [local:1] Next hop is 00000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 00000000000000000000000000000001
             is 00000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01000000000000000000000000000000
  [local:1] Next hop is 01000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01000000000000000000000000000000
             is 01000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01000000000000000000000000000001
  [local:1] Next hop is 01000000000000000000000000000000 (routing table)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01000000000000000000000000000001
             is 01000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 02000000000000000000000000000000
  [local:1] Next hop is self (leaf set)
  Next hop from 0123456789abcdef0123456789abcdef
             to 02000000000000000000000000000000
             is local delivery
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01100000000000000000000000000000
  [local:1] Next hop is 01000000000000000000000000000000 (routing table fallback)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01100000000000000000000000000000
             is 01000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 01200000000000000000000000000000
  [local:1] Next hop is self (last resort)
  Next hop from 0123456789abcdef0123456789abcdef
             to 01200000000000000000000000000000
             is local delivery
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 10000000000000000000000000000000
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set fallback)
  Next hop from 0123456789abcdef0123456789abcdef
             to 10000000000000000000000000000000
             is 04000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for f0000000000000000000000000000000
  [local:1] Next hop is 00000000000000000000000000000000 (routing table fallback)
  Next hop from 0123456789abcdef0123456789abcdef
             to f0000000000000000000000000000000
             is 00000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 04000000000000000000000000000000
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set)
  Next hop from 0123456789abcdef0123456789abcdef
             to 04000000000000000000000000000000
             is 04000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 04000000000000000000000000000001
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set)
  Next hop from 0123456789abcdef0123456789abcdef
             to 04000000000000000000000000000001
             is 04000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 05ffffffffffffffffffffffffffffff
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set)
  Next hop from 0123456789abcdef0123456789abcdef
             to 05ffffffffffffffffffffffffffffff
             is 04000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 06000000000000000000000000000000
  [local:1] Next hop is 08000000000000000000000000000000 (leaf set)
  Next hop from 0123456789abcdef0123456789abcdef
             to 06000000000000000000000000000000
             is 08000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 06000000000000000000000000000001
  [local:1] Next hop is 08000000000000000000000000000000 (leaf set)
  Next hop from 0123456789abcdef0123456789abcdef
             to 06000000000000000000000000000001
             is 08000000000000000000000000000000
  --- [0123456789abcdef0123456789abcdef]
  --- print next hop for 0a0000000000000000000000000a0000
  [local:1] Next hop is 04000000000000000000000000000000 (leaf set fallback)
  Next hop from 0123456789abcdef0123456789abcdef
             to 0a0000000000000000000000000a0000
             is 04000000000000000000000000000000
  ---
  [local:5] Free node
  [local:4] Free node
  [local:3] Free node
  [local:2] Free node
  [local:1] Free node

  $ CLOG=DEBUG croissant test <<EOF
  > new node 01000000000000000000000000000000;
  > new node 01100000000000000000000000000000;
  > new node 01110000000000000000000000000000;
  > node 01000000000000000000000000000000 {
  >     add routing table entry 01100000000000000000000000000000;
  > };
  > node 01100000000000000000000000000000 {
  >     add leaf set entry 01110000000000000000000000000000;
  > };
  > node 01000000000000000000000000000000 {
  >     send hello to 01110000000000000000000000000000;
  > };
  > EOF
  --- new node 01000000000000000000000000000000
  [local:1] New node 01000000000000000000000000000000
  [local:1] New routing table
  [local:1] New leaf set
  --- new node 01100000000000000000000000000000
  [local:2] New node 01100000000000000000000000000000
  [local:2] New routing table
  [local:2] New leaf set
  --- new node 01110000000000000000000000000000
  [local:3] New node 01110000000000000000000000000000
  [local:3] New routing table
  [local:3] New leaf set
  --- [01000000000000000000000000000000]
  --- add routing table entry 01100000000000000000000000000000
  [local:1] (rtable) [ 2/1] 01100000000000000000000000000000 (new entry)
  --- [01100000000000000000000000000000]
  --- add leaf set entry 01110000000000000000000000000000
  [local:2] (leafset) [+ 1] Add 01110000000000000000000000000000
  --- [01000000000000000000000000000000]
  --- send "hello" to 01110000000000000000000000000000
  [local:1] Send message to 01110000000000000000000000000000
  [local:1] Next hop is 01100000000000000000000000000000 (routing table)
  [local:1] {print} Spy on message from 01000000000000000000000000000000 to 01110000000000000000000000000000
  [local:1] Forward via local:2
  [local:1] {local} Send message to local:2
  [local:2] Next hop is 01110000000000000000000000000000 (leaf set)
  [local:2] {print} Spy on message from 01000000000000000000000000000000 to 01110000000000000000000000000000
  [local:2] Forward via local:3
  [local:2] {local} Send message to local:3
  [local:3] Next hop is self (leaf set)
  [local:3] Deliver message to application "crs_print_message"
  [local:3] Received 01110000000000000000000000000000 hello
  ---
  [local:3] Free node
  [local:2] Free node
  [local:1] Free node
